# data/effect_ability.yaml
# yaml-language-server: $schema=../packages/schema/schema/effect.schema.json
# @metaType effect
# @version 1.0.0
- id: effect_ability_amplify_power_consume_ruodian
  trigger: BeforeUseSkillCheck
  priority: 0
  apply:
    type: amplifyPower
    target:
      base: usingSkillContext
    value: 1.25
  condition:
    type: every
    conditions:
      - type: checkSelf
      - &hp_below_1_4
        type: evaluate
        target:
          base: self
          chain:
            - type: select
              arg:
                type: base
                arg: currentHp
        evaluator:
          type: compare
          operator: '<'
          value:
            type: dynamic
            selector:
              base: self
              chain:
                - type: select
                  arg:
                    type: base
                    arg: maxHp
                - type: divide
                  arg: 4
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: select
              arg:
                type: dynamic
                arg: skill
            - type: select
              arg:
                type: base
                arg: tags
            - type: flat
        evaluator:
          type: contain
          tag: consume_ruodian
- id: effect_ability_fire_power_boost_below_25_percent
  trigger: AfterUseSkillCheck
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - *hp_below_1_4
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: selectPath
              arg: category
        evaluator:
          type: same
          value: Fire
  apply:
    type: amplifyPower
    target: usingSkillContext
    value: 1.25
- id: effect_ability_damage_reduction_below_25_percent
  trigger: OnDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: selfBeDamaged
      - *hp_below_1_4
  apply:
    type: addModified
    target:
      base: damageContext
    delta: 0
    percent: -25
- id: effect_ability_heal_1_16_when_qingtian
  trigger: TurnEnd
  priority: 0
  condition:
    type: every
    conditions:
      - type: petIsActive
      - type: evaluate
        target:
          base: battle
          chain:
            - type: select
              arg:
                type: base
                arg: marks
            - type: flat
            - type: whereAttr
              extractor: baseId
              evaluator:
                type: same
                value: mark_global_qingtian
        evaluator:
          type: exist
  apply:
    type: heal
    target:
      base: self
    value:
      type: dynamic
      selector:
        base: self
        chain:
          - type: select
            arg:
              type: base
              arg: maxHp
          - type: divide
            arg: 16
- id: effect_ability_damage_amplify_10_percent_weight_100kg
  trigger: BeforeUseSkillCheck
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: self
          chain:
            - type: select
              arg:
                type: dynamic
                arg: stat.weight
        evaluator:
          type: compare
          operator: '>='
          value: 100
  apply:
    type: amplifyPower
    target:
      base: usingSkillContext
    value: 1.1
- id: effect_ability_physical_damage_reduction_below_25_percent
  trigger: OnDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: selfBeDamaged
      - *hp_below_1_4
      - type: evaluate
        target:
          base: damageContext
          chain:
            - type: selectPath
              arg: damageType
        evaluator:
          type: same
          value: Physical
  apply:
    type: addModified
    target:
      base: damageContext
    delta: 0
    percent: -30
- id: effect_ability_water_power_boost_below_25_percent
  trigger: AfterUseSkillCheck
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - *hp_below_1_4
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: selectPath
              arg: category
        evaluator:
          type: same
          value: Water
  apply:
    type: amplifyPower
    target: usingSkillContext
    value: 1.25
- id: effect_ability_damage_amplify_10_percent_foe_has_manxingduyao
  trigger: OnBeforeCalculateDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: foeMarks
          chain:
            - type: whereAttr
              extractor:
                type: base
                arg: baseId
              evaluator:
                type: same
                value: mark_manxingduyao
        evaluator:
          type: exist
  apply:
    type: addModified
    target: damageContext
    percent: 10
    delta: 0
- id: effect_ability_damage_amplify_10_percent_has_kongqichuliang
  trigger: OnBeforeCalculateDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: selfMarks
          chain:
            - type: whereAttr
              extractor:
                type: base
                arg: baseId
              evaluator:
                type: same
                value: mark_kongqichuliang
        evaluator:
          type: exist
  apply:
    type: addModified
    target: damageContext
    percent: 10
    delta: 0
- id: effect_ability_add_water_skill_accuracy_5_percent_has_kongqichuliang
  trigger: AfterUseSkillCheck
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: selfMarks
          chain:
            - type: whereAttr
              extractor:
                type: base
                arg: baseId
              evaluator:
                type: same
                value: mark_kongqichuliang
        evaluator:
          type: exist
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: select
              arg: element
        evaluator:
          type: same
          value: Water
  apply:
    type: addAccuracy
    target: usingSkillContext
    value: 5
- id: effect_ability_add_power_50_percent_normal
  trigger: AfterUseSkillCheck
  priority: 0
  apply:
    type: amplifyPower
    target: usingSkillContext
    value: 1.5
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: select
              arg: element
        evaluator:
          type: same
          value: Normal
- id: effect_ability_add_shuiwenpingzhang_value_if_yutian
  trigger: AfterUseSkillCheck
  priority: 0
  apply:
    type: setConfig
    target: self
    key: effect_skill_add_mark_shuiwenpingzhang.multiply_value
    value:
      type: conditional
      trueValue: 1.5
      falseValue: 1
      condition:
        type: evaluate
        target:
          base: battle
          chain:
            - type: select
              arg:
                type: base
                arg: marks
            - type: flat
            - type: whereAttr
              extractor: baseId
              evaluator:
                type: same
                value: mark_global_yutian
        evaluator:
          type: exist
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: usingSkillContext
          chain:
            - type: select
              arg:
                type: dynamic
                arg: skill
            - type: select
              arg: baseId
        evaluator:
          type: same
          value: skill_shuiwenpingzhang
- id: effect_ability_damage_amplify_15_percent_foe_has_shaoshang
  trigger: OnBeforeCalculateDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: foeMarks
          chain:
            - type: whereAttr
              extractor:
                type: base
                arg: baseId
              evaluator:
                type: same
                value: mark_shaoshang
        evaluator:
          type: exist
  apply:
    type: addModified
    target: damageContext
    percent: 15
    delta: 0
- id: effect_ability_damage_amplify_15_percent_foe_has_xuanyun
  trigger: OnBeforeCalculateDamage
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: foeMarks
          chain:
            - type: whereAttr
              extractor:
                type: base
                arg: baseId
              evaluator:
                type: same
                value: mark_xuanyun
        evaluator:
          type: exist
  apply:
    type: addModified
    target: damageContext
    percent: 15
    delta: 0
- id: effect_ability_add_skill_accuracy_10_percent_when_yanre
  trigger: AfterUseSkillCheck
  priority: 0
  condition:
    type: every
    conditions:
      - type: checkSelf
      - type: evaluate
        target:
          base: battle
          chain:
            - type: select
              arg:
                type: base
                arg: marks
            - type: flat
            - type: whereAttr
              extractor: baseId
              evaluator:
                type: same
                value: mark_global_yanre
        evaluator:
          type: exist
  apply:
    type: addAccuracy
    target: usingSkillContext
    value: 10
- id: effect_ability_add_shoufashanghaizengjia_on_lead
  trigger: OnBattleStart
  priority: 0
  apply:
    type: addMark
    target: self
    mark:
      type: entity:baseMark
      value: mark_shoufashanghaizengjia
  condition:
    type: petIsActive
# 增加自己10%闪避率
- id: effect_ability_add_self_evasion_10
  trigger: OnBattleStart
  priority: 0
  apply:
    type: addAttributeModifier
    target:
      base: self
    stat: evasion
    modifierType: delta
    value: 10
